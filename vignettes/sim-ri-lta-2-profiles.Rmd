---
title: "Comparing Two-Profile RI-LTA and CULTA Models"
author: Ivan Jacob Agaloos Pesigan
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Comparing Two-Profile RI-LTA and CULTA Models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---






``` r
library(manCULTA)
```



We generate data using the CULTA model with two latent profiles, where profile membership depends on a covariate and profile transitions follow a multinomial structure. However, for model fitting, we impose a simpler structure by fitting a random intercept latent transition analysis (RI-LTA) model. We then compare this misspecified model to the correctly specified two-profile CULTA model.

## Data Generation


``` r
# complete list of R function arguments

# random seed for reproducibility
set.seed(42)

# dimensions
n # number of individuals
#> [1] 1000
m # measurement occasions
#> [1] 6
p # number of items
#> [1] 4
q # common trait dimension
#> [1] 1

# covariate parameters
mu_x
#> [1] 11.4009
sigma_x
#> [1] 24.67566

# profile membership and transition parameters
nu_0
#> [1] -3.563
kappa_0
#> [1] 0.122
alpha_0
#> [1] -3.586
beta_00
#> [1] 2.25
gamma_00
#> [1] 0.063
gamma_10
#> [1] 0.094

# trait parameters
psi_t
#>      [,1]
#> [1,]  0.1
mu_t
#> [1] 0
psi_p
#>      [,1] [,2] [,3] [,4]
#> [1,]  0.1  0.0  0.0  0.0
#> [2,]  0.0  0.1  0.0  0.0
#> [3,]  0.0  0.0  0.5  0.0
#> [4,]  0.0  0.0  0.0  0.5
mu_p
#> [1] 0 0 0 0
common_trait_loading
#>      [,1]
#> [1,]    1
#> [2,]    1
#> [3,]    1
#> [4,]    1

# state parameters
common_state_loading
#>      [,1]
#> [1,]    1
#> [2,]    1
#> [3,]    1
#> [4,]    1
phi_0
#> [1] 0
phi_1
#> [1] 0.311
psi_s0
#> [1] 1
psi_s
#> [1] 0.25
theta
#>      [,1] [,2] [,3] [,4]
#> [1,] 0.15 0.00 0.00 0.00
#> [2,] 0.00 0.15 0.00 0.00
#> [3,] 0.00 0.00 0.15 0.00
#> [4,] 0.00 0.00 0.00 0.15

# profile-specific means
mu_profile
#>       [,1]   [,2]
#> [1,] 2.253 -0.278
#> [2,] 1.493 -0.165
#> [3,] 1.574 -0.199
#> [4,] 1.117 -0.148
```


``` r
data <- GenCULTA2Profiles(
  n = n,
  m = m,
  mu_x = mu_x,
  sigma_x = sigma_x,
  nu_0 = nu_0,
  kappa_0 = kappa_0,
  alpha_0 = alpha_0,
  beta_00 = beta_00,
  gamma_00 = gamma_00,
  gamma_10 = gamma_10,
  mu_t = mu_t,
  psi_t = psi_t,
  mu_p = mu_p,
  psi_p = psi_p,
  common_trait_loading = common_trait_loading,
  common_state_loading = common_state_loading,
  phi_0 = phi_0,
  phi_1 = phi_1,
  psi_s0 = psi_s0,
  psi_s = psi_s,
  theta = theta,
  mu_profile = mu_profile
)
```



## Model Fitting

The `FitLTA2Profiles` function fits the misspecified two-profile RI-LTA model using `Mplus`.
**Note:** This function requires that **Mplus** is already installed on the system.


``` r
rilta <- FitRILTA2Profiles(data = data)
```

The `FitCULTA2Profiles` function fits the correct two-profile model using `Mplus`.
**Note:** This function requires that **Mplus** is already installed on the system. To speed up model fitting, consider using the `ncores` argument to leverage multiple cores.


``` r
culta <- FitCULTA2Profiles(data = data)
```





## Model Comparison

The `anova` function can be used to compare the two fitted models.


``` r
anova(rilta, culta)
#> $fit
#>                     logLik df correction      AIC      BIC     aBIC   entropy
#> 2-profile RI-LTA -30931.40 22   2.475479 61906.80 62014.77 61944.89 0.8932332
#> 2-profile CULTA  -23536.42 33   0.999548 47138.83 47300.79 47195.98 0.9410144
#> 
#> $test
#>  chi_diff   df_diff   p_value 
#> -7575.607    11.000     1.000
```

## Parameter Recovery

Parameter recovery was assessed by calculating the differences between the population values and the estimated profile-specific means and log-odds.



Table: Parameter Recovery

|         | Parameter| RI-LTA Estimate| Difference| CULTA Estimate| Difference|
|:--------|---------:|---------------:|----------:|--------------:|----------:|
|mu_10    |     2.253|       1.5218012|  0.7311988|      2.2892154| -0.0362154|
|mu_20    |     1.493|       1.2453362|  0.2476638|      1.5474649| -0.0544649|
|mu_30    |     1.574|       1.3730178|  0.2009822|      1.6470261| -0.0730261|
|mu_40    |     1.117|       0.9565883|  0.1604117|      1.1475578| -0.0305578|
|mu_11    |    -0.278|      -0.5157223|  0.2377223|     -0.2876850|  0.0096850|
|mu_21    |    -0.165|      -0.4139780|  0.2489780|     -0.1842756|  0.0192756|
|mu_31    |    -0.199|      -0.4332938|  0.2342938|     -0.1778213| -0.0211787|
|mu_41    |    -0.148|      -0.3643389|  0.2163389|     -0.1727158|  0.0247158|
|nu_0     |    -3.563|      -1.3256314| -2.2373686|     -4.2691825|  0.7061825|
|alpha_0  |    -3.586|      -2.7385506| -0.8474494|     -3.5915924|  0.0055924|
|kappa_0  |     0.122|       0.0293941|  0.0926059|      0.1577775| -0.0357775|
|beta_00  |     2.250|       2.9771867| -0.7271867|      2.0830270|  0.1669730|
|gamma_00 |     0.063|       0.0016448|  0.0613552|      0.0779785| -0.0149785|
|gamma_10 |     0.094|       0.0802600|  0.0137400|      0.0989865| -0.0049865|


